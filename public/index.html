<body>
    <div>
        CPU Count: <input id='cpu'><br>
        SSD Count: <input id='ssd'><br>
        GPU Count: <input id='gpu'><br>
        NIC Count: <input id='nic'><br>
        Mach Name: <input id='name'><br>
        Group ID: <input id='gid'><br>
        Fabric ID: <input id='fid'><br>
        <button onClick="createMachine()">Create Machine</button><br><br>

        Machine ID: <input id='mid2'><br>
        Fabric ID: <input id='fid2'><br>
        <button onClick="deleteMachine()">Delete Machine</button><br><br>

        Group ID: <input id='gid3'><br>
        Fabric ID: <input id='fid3'><br>
        <button onClick="deleteGroup()">Delete Group</button><br><br>

        <button onClick="reload()">Reload Fabric</button>

    </div>

    <br>

    <div id='liqid-state'></div>
    <script src="/socket.io.js"></script>
    <script>
        const socket = io(window.location.href);

        function createMachine() {
            create(
                parseInt(document.getElementById('cpu').value),
                parseInt(document.getElementById('ssd').value),
                parseInt(document.getElementById('gpu').value),
                parseInt(document.getElementById('nic').value),
                document.getElementById('name').value,
                parseInt(document.getElementById('gid').value),
                parseInt(document.getElementById('fid').value)
            );
        }

        function deleteMachine() {
            socket.emit('delete-machine', {
                "fabr_id": parseInt(document.getElementById('fid2').value),
                "id": document.getElementById('mid2').value
            });
        }

        function deleteGroup() {
            socket.emit('delete-group', {
                "fabr_id": parseInt(document.getElementById('fid3').value),
                "id": document.getElementById('gid3').value
            });
        }

        function reload() {
            socket.emit('reload');
        }

        function create(c, s, g, n, name, gid, fid) {
            console.log('Trying to compose.');
            socket.emit('create', {
                "fabr_id": fid,
                "cpu": c,
                "gpu": g,
                "ssd": s,
                "nic": n,
                "fpga": 0,
                "name": name,
                "groupId": gid
            });
        }

        socket.on('update', (update) => {
            console.log('Received an update!');
            document.getElementById('liqid-state').innerHTML = JSON.stringify(update);
        });
        socket.on('success', (msg) => {
            console.log(msg);
        });
        socket.on('err', (err) => {
            console.log(err);
        });
    </script>
</body>